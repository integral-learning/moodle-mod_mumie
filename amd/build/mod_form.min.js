define ("mod_mumie/mod_form",["jquery","core/templates","core/modal_factory","auth_mumie/mumie_server_config","core/ajax"],function(){var d=document.getElementById("id_add_server_button"),e=document.getElementsByName("mumie_missing_config")[0],f,g,h=function(){var a,c=document.getElementById("id_server");return{init:function init(b){a=b;c.onchange=function(){j.updateOptions()}},getSelectedServer:function getSelectedServer(){var b=c.options[c.selectedIndex].text;return a.find(function(a){return a.name===b})},disable:function disable(){c.disabled=!0;b(c)},getAllServers:function getAllServers(){return a}}}(),i=function(){var i=document.getElementById("id_prb_selector_btn"),j,m=document.getElementsByName("mumie_org")[0].value;function a(a){if(!j){return}j.postMessage(JSON.stringify(a),f)}function b(){var b=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"";a({success:!0,message:b})}function c(){var b=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"";a({success:!1,message:b})}function d(){window.addEventListener("message",function(a){if(a.origin!==f){return}var d=JSON.parse(a.data),g=!1!==d.isGraded;try{k.setLanguage(d.language);l.setSelection(d.link+"?lang="+d.language);l.setIsGraded(g);b();window.focus();e()}catch(a){c(a.message)}},!1)}function e(){require(["core/str","core/notification"],function(a,b){a.get_strings([{key:"mumie_form_updated_selection",component:"mod_mumie"}]).done(function(a){b.addNotification({message:a[0],type:"info"})}).fail(b.exception)})}return{init:function init(){var a=l.getGradingType();i.onclick=function(){j=window.open(f+"/lms-problem-selector?org="+m+"&serverUrl="+encodeURIComponent(h.getSelectedServer().urlprefix)+"&problemLang="+k.getSelectedLanguage()+"&origin="+encodeURIComponent(window.location.origin)+"&uiLang="+g+"&gradingType="+a,"_blank")};window.onclose=function(){b()};window.addEventListener("beforeunload",function(){b()},!1);d()},disable:function disable(){i.disabled=!0}}}(),j=function(){var d=document.getElementById("id_mumie_course"),e=document.getElementsByName("mumie_coursefile")[0];function a(a){var b=document.createElement("option"),c=k.getSelectedLanguage(),e;if(!a.languages.includes(c)){e=a.name[0]}else{e=a.name.find(function(a){return a.language===c})}b.setAttribute("value",e.value);b.text=e.value;d.append(b)}function c(){e.value=j.getSelectedCourse().coursefile}return{init:function init(a){d.onchange=function(){c()};j.updateOptions(a?e.value:!1)},getSelectedCourse:function getSelectedCourse(){var a=d.options[d.selectedIndex].text,b=h.getSelectedServer().courses;return b.find(function(b){return b.name.some(function(b){return b.value===a})})},disable:function disable(){d.disabled=!0;b(d)},updateOptions:function updateOptions(){var f=e.value;b(d);d.selectedIndex=0;h.getSelectedServer().courses.forEach(function(b){a(b);if(b.coursefile===f){d.selectedIndex=d.childElementCount-1}});c()}}}(),k=function(){var b=document.getElementById("id_language");function a(a){return j.getSelectedCourse().languages.includes(a)}return{getSelectedLanguage:function getSelectedLanguage(){return b.value},setLanguage:function setLanguage(c){if(!a(c)){throw new Error("Selected language not available")}b.value=c}}}(),l=function(){var n=document.getElementsByName("taskurl")[0],o=document.getElementById("id_name"),p=document.getElementById("id_task_display_element"),q=document.getElementById("id_mumie_isgraded");function a(){var a=c(l.getSelectedTask());if(!b()){o.value=a}p.value=a}function b(){if(0===o.value.length){return!1}return!e().includes(o.value)}function c(a){if(!a){return null}var b=k.getSelectedLanguage(),c=a.headline.find(function(a){return a.language===b});return c?c.name:null}function d(){return h.getAllServers().flatMap(function(a){return a.courses}).flatMap(function(a){return a.tasks})}function e(){return d().flatMap(function(a){return a.headline}).map(function(a){return a.name}).concat(j.getSelectedCourse().name.map(function(a){return a.value}))}function f(a){return g(a.link)}function g(a){return a+"?lang="+k.getSelectedLanguage()}function i(){var a="0"===q.value;document.getElementById("id_points").disabled=a;document.getElementById("id_gradepass").disabled=a;document.getElementById("id_duedate_enabled").disabled=a;document.getElementById("id_gradecat").disabled=a}function m(a){var b=[];for(var c in a.name){var d=a.name[c];b.push({name:d.value,language:d.language})}return{link:a.link,headline:b}}return{init:function init(){a()},getSelectedTask:function getSelectedTask(){var a=n.value,b=j.getSelectedCourse().tasks.slice();b.push(m(j.getSelectedCourse()));return b.find(function(b){return f(b)===a})},setSelection:function setSelection(b){n.value=b;a()},setIsGraded:function setIsGraded(a){if(null===a){q.value=null}q.value=a?"1":"0";i()},getGradingType:function getGradingType(){var a=q.value;if("1"===a){return"graded"}else if("0"===a){return"ungraded"}return"all"}}}(),m=function(){var e=document.getElementsByName("mumie_multi_edit_property"),f=document.getElementsByName("mumie_selected_task_properties")[0],g=[],h=document.getElementsByName("mumie_multi_edit_task"),i=document.getElementsByName("mumie_selected_tasks")[0],j=[],k=document.getElementsByName("mumie_multi_edit_section");function a(a,b){if(!a.includes(b)){a.push(b)}}function b(){h.forEach(function(a){a.onchange=function(){if(!a.checked){j=j.filter(function(b){return b!==a.value})}else{j.push(a.value)}i.value=JSON.stringify(j)}})}function c(){e.forEach(function(a){a.onchange=function(){if(!a.checked){g=g.filter(function(b){return b!==a.value})}else{g.push(a.value)}f.value=JSON.stringify(g)}})}function d(){k.forEach(function(b){b.onchange=function(){if(!b.checked){h.forEach(function(a){if(a.getAttribute("section")===b.value){a.checked=!1;j=j.filter(function(b){return a.value!==b})}})}else{h.forEach(function(c){if(c.getAttribute("section")===b.value){c.checked=!0;a(j,c.value)}})}i.value=JSON.stringify(j)}})}return{init:function init(){b();c();d()}}}();function a(a){require(["core/str","core/notification"],function(b,c){b.get_strings([{key:a,component:"mod_mumie"}]).done(function(a){c.addNotification({message:a[0]+"<b>"+e.getAttribute("value")+"</b>",type:"problem"})}).fail(c.exception)});h.disable();j.disable();k.disable();i.disable()}return{init:function init(b,e,k){f=e;g=k;var n=document.getElementById("id_name").getAttribute("value"),o=JSON.parse(document.getElementsByName("mumie_server_structure")[0].value);if(n&&!c()){a("mumie_form_missing_server")}else if(!o.length){a("mumie_form_no_server_conf")}else{h.init(o);j.init(n);l.init(n);m.init();i.init()}m.init();if(d){require(["auth_mumie/mumie_server_config"],function(a){a.init(d,b)})}}};function b(a){while(a.firstChild){a.removeChild(a.firstChild)}}function c(){return""===document.getElementsByName("mumie_missing_config")[0].getAttribute("value")}});
//# sourceMappingURL=mod_form.min.js.map
