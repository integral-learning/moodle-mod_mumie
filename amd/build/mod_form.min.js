define ("mod_mumie/mod_form",["jquery","core/templates","core/modal_factory","auth_mumie/mumie_server_config","core/ajax"],function(){var d=document.getElementById("id_add_server_button"),e=document.getElementsByName("mumie_missing_config")[0],f=function(){var a,c=document.getElementById("id_server");return{init:function init(b){a=b;c.onchange=function(){g.updateOptions();h.updateOptions();k.updateOptions();j.updateOptions()}},getSelectedServer:function getSelectedServer(){var b=c.options[c.selectedIndex].text;for(var d in a){var e=a[d];if(e.name==b){return e}}return null},disable:function disable(){c.disabled=!0;b(c)},getAllServers:function getAllServers(){return a}}}(),g=function(){var d=document.getElementById("id_mumie_course"),e=document.getElementsByName("mumie_coursefile")[0];function a(a){var b=document.createElement("option"),c=h.getSelectedLanguage(),e;if(!a.languages.includes(c)){e=a.name[0]}else{for(var f in a.name){if(a.name[f].language==c){e=a.name[f]}}}b.setAttribute("value",e.value);b.text=e.value;d.append(b)}function c(){e.value=g.getSelectedCourse().coursefile}return{init:function init(a){d.onchange=function(){c();h.updateOptions();k.updateOptions();j.updateOptions()};g.updateOptions(a?e.value:!1)},getSelectedCourse:function getSelectedCourse(){var a=d.options[d.selectedIndex].text,b=f.getSelectedServer().courses;for(var c in b){var e=b[c];for(var g in e.name){if(e.name[g].value==a){return e}}}return null},disable:function disable(){d.disabled=!0;b(d)},updateOptions:function updateOptions(){var g=e.value;b(d);d.selectedIndex=0;var h=f.getSelectedServer().courses;for(var j in h){var i=h[j];a(i);if(i.coursefile==g){d.selectedIndex=d.childElementCount-1}}c()}}}(),h=function(){var c=document.getElementById("id_language");function a(a){var b=document.createElement("option");b.setAttribute("value",a);b.text=a;c.append(b)}return{init:function init(){c.onchange=function(){j.updateOptions();g.updateOptions()};h.updateOptions()},getSelectedLanguage:function getSelectedLanguage(){return c.options[c.selectedIndex].text},disable:function disable(){c.disabled=!0;b(c)},updateOptions:function updateOptions(){var d=h.getSelectedLanguage();b(c);c.selectedIndex=0;var e=g.getSelectedCourse().languages;for(var f in e){var i=e[f];a(i);if(i==d){c.selectedIndex=c.childElementCount-1}}}}}(),j=function(){var q=document.getElementById("id_taskurl"),r=document.getElementById("id_name"),s=document.getElementById("id_mumie_complete_course");function a(){if(!c()){r.value=d(j.getSelectedTask())}}function c(){if(0==r.value.length){return!1}return!i().includes(r.value)}function d(a){if(!a){return null}for(var b in a.headline){var c=a.headline[b];if(c.language==h.getSelectedLanguage()){return c.name}}return null}function e(){var a=[];for(var b in f.getAllServers()){var c=f.getAllServers()[b];for(var d in c.courses){var e=c.courses[d];for(var g in e.tasks){var h=e.tasks[g];a.push(h)}}}return a}function i(){var a=[],b=e();b.push(o(g.getSelectedCourse()));for(var c in b){var d=b[c];for(var f in d.headline){a.push(d.headline[f].name)}}var h=g.getSelectedCourse();for(var i in h.name){var j=h.name[i];a.push(j.value)}return a}function l(a){return a.link+"?lang="+h.getSelectedLanguage()}function m(a){if(null!==d(a)){var b=document.createElement("option");b.setAttribute("value",l(a));b.text=d(a);q.append(b)}}function n(a){var b=o(a),c=document.createElement("option");c.setAttribute("value",l(b));c.text=d(b);q.append(c)}function o(a){var b=[];for(var c in a.name){var d=a.name[c];b.push({name:d.value,language:d.language})}return{link:a.link,headline:b}}function p(){return s.checked}return{init:function init(b){a();q.onchange=function(){a()};s.onchange=function(){j.updateOptions();k.updateOptions()};j.updateOptions(b?q.options[q.selectedIndex].getAttribute("value"):void 0)},getSelectedTask:function getSelectedTask(){var a=q.options[q.selectedIndex]==void 0?void 0:q.options[q.selectedIndex].getAttribute("value"),b=g.getSelectedCourse(),c=b.tasks.slice();c.push(o(b));for(var d in c){var e=c[d];if(a==l(e)){return e}}return null},disable:function disable(){q.disabled=!0;b(q)},updateOptions:function updateOptions(c){b(q);q.selectedIndex=0;if(p()){n(g.getSelectedCourse())}else{var d=k.filterTasks(g.getSelectedCourse().tasks);for(var e in d){var f=d[e];m(f);if(c===l(f)){q.selectedIndex=q.childElementCount-1}}}a()},useCompleteCourse:function useCompleteCourse(){return p()}}}(),k=function(){var k=document.getElementById("mumie_filter_section"),l=document.getElementById("mumie_filter_wrapper"),m=document.getElementById("mumie_filter_header"),n=[];function a(a){var b=document.createElement("div");b.classList.add("row","fitem","form-group","mumie-filter");var d=c(a),f=document.createElement("label");f.innerHTML="<i class=\"fa fa-caret-down mumie-icon\"></i>"+a.name;f.classList.add("col-md-3","mumie-collapsable");f.onclick=function(){e(d)};b.appendChild(f);b.appendChild(d);l.appendChild(b)}function c(a){var b=document.createElement("div");b.classList.add("col-md-9","felement","mumie_selection_box");for(var c in a.values){n[a.name]=[];var e=document.createElement("div");e.classList.add("mumie_input_wrapper");var f=a.values[c],g=document.createElement("input");g.type="checkbox";g.value=f;d(a,g);var h=document.createElement("label");h.innerText=f;h.style="padding-left: 5px";e.appendChild(g);e.appendChild(h);b.insertBefore(e,b.firstChild)}return b}function d(a,b){b.onclick=function(){if(!b.checked){var c=[];for(var d in n[a.name]){var e=n[a.name][d];if(e!=b.value){c.push(e)}}n[a.name]=c}else{n[a.name].push(b.value)}j.updateOptions()}}function e(a){a.toggleAttribute("hidden")}function f(a,b){var c=[];for(var d in a){var e=a[d];if(h(e,b)){c.push(e)}}return c}function h(a,b){var c=[];for(var d in a.tags){var e=a.tags[d];c[e.name]=e.values}for(var f in Object.keys(b)){var g=Object.keys(b)[f];if(0==b[g].length){continue}if(!c[g]){return!1}if(!i(b[g],c[g])){return!1}}return!0}function i(a,b){if(!Array.isArray(a)||!Array.isArray(b)){return!1}for(var c=0;c<a.length;c++){if(b.includes(a[c])){return!0}}return!1}return{init:function init(){this.updateOptions();m.onclick=function(){e(l)}},updateOptions:function updateOptions(){if(j.useCompleteCourse()){k.style="display: none"}else{k.style="display: flex"}var c=g.getSelectedCourse().tags;n=[];if(0<c.length){k.hidden=!1}else{k.hidden=!0}b(l);for(var d in c){var e=c[d];a(e)}},filterTasks:function filterTasks(a){return f(a,n)}}}();function a(a){require(["core/str","core/notification"],function(b,c){b.get_strings([{key:a,component:"mod_mumie"}]).done(function(a){c.addNotification({message:a[0]+"<b>"+e.getAttribute("value")+"</b>",type:"problem"})}).fail(c.exception)});f.disable();g.disable();h.disable();j.disable()}return{init:function init(b){var e=document.getElementById("id_name").getAttribute("value"),i=JSON.parse(document.getElementsByName("mumie_server_structure")[0].value);if(e&&!c()){a("mumie_form_missing_server")}else if(!i.length){a("mumie_form_no_server_conf")}else{f.init(i);g.init(e);j.init(e);h.init();k.init()}if(d){require(["auth_mumie/mumie_server_config"],function(a){a.init(d,b)})}}};function b(a){while(a.firstChild){a.removeChild(a.firstChild)}}function c(){return""===document.getElementsByName("mumie_missing_config")[0].getAttribute("value")}});
//# sourceMappingURL=mod_form.min.js.map
