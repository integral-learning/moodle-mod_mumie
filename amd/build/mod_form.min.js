define ("mod_mumie/mod_form",["jquery","core/templates","core/modal_factory","auth_mumie/mumie_server_config","core/ajax"],function(){var c=document.getElementById("id_add_server_button"),d=document.getElementsByName("mumie_missing_config")[0],e="http://localhost:7070",f=function(){var b,c=document.getElementById("id_server");return{init:function init(a){b=a;c.onchange=function(){h.updateOptions();j.updateOptions();k.updateOptions()}},getSelectedServer:function getSelectedServer(){var a=c.options[c.selectedIndex].text;for(var d in b){var e=b[d];if(e.name==a){return e}}return null},disable:function disable(){c.disabled=!0;a(c)},getAllServers:function getAllServers(){return b}}}(),g=function(){var h=document.getElementById("id_prb_selector_btn"),i,l=document.getElementsByName("mumie_org")[0].value;function a(a){if(!i){return}i.postMessage(JSON.stringify(a),e)}function b(){var b=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"";a({success:!0,message:b})}function c(){var b=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"";a({success:!1,message:b})}function d(){window.addEventListener("message",function(a){if(a.origin!=e){return}var d=JSON.parse(a.data);try{j.setLanguage(d.language);k.updateOptions(d.link+"?lang="+d.language);b();window.focus();g()}catch(a){c(a.message)}},!1)}function g(){require(["core/str","core/notification"],function(a,b){a.get_strings([{key:"mumie_form_updated_selection",component:"mod_mumie"}]).done(function(a){b.addNotification({message:a[0],type:"info"})}).fail(b.exception)})}return{init:function init(){h.onclick=function(){i=window.open(e+"/lms-problem-selector?org="+l+"&serverUrl="+encodeURIComponent(f.getSelectedServer().urlprefix)+"&lang="+j.getSelectedLanguage()+"&problem="+k.getSelectedTask().link+"&origin="+encodeURIComponent(window.location.origin),"_blank")};window.onclose=function(){b()};window.addEventListener("beforeunload",function(){b()},!1);d()},disable:function disable(){h.disabled=!0}}}(),h=function(){var d=document.getElementById("id_mumie_course"),e=document.getElementsByName("mumie_coursefile")[0];function b(a){var b=document.createElement("option"),c=j.getSelectedLanguage(),e;if(!a.languages.includes(c)){e=a.name[0]}else{for(var f in a.name){if(a.name[f].language==c){e=a.name[f]}}}b.setAttribute("value",e.value);b.text=e.value;d.append(b)}function c(){e.value=h.getSelectedCourse().coursefile}return{init:function init(a){d.onchange=function(){c();j.updateOptions();k.updateOptions()};h.updateOptions(a?e.value:!1)},getSelectedCourse:function getSelectedCourse(){var a=d.options[d.selectedIndex].text,b=f.getSelectedServer().courses;for(var c in b){var e=b[c];for(var g in e.name){if(e.name[g].value==a){return e}}}return null},disable:function disable(){d.disabled=!0;a(d)},updateOptions:function updateOptions(){var g=e.value;a(d);d.selectedIndex=0;var h=f.getSelectedServer().courses;for(var j in h){var i=h[j];b(i);if(i.coursefile==g){d.selectedIndex=d.childElementCount-1}}c()}}}(),j=function(){var c=document.getElementById("id_language");function b(a){var b=document.createElement("option");b.setAttribute("value",a);b.text=a;c.append(b)}return{init:function init(){c.onchange=function(){k.updateOptions();h.updateOptions()};j.updateOptions()},getSelectedLanguage:function getSelectedLanguage(){return c.options[c.selectedIndex].text},setLanguage:function setLanguage(a){for(var b in c.options){var d=c.options[b];if(d.value==a){c.selectedIndex=b;h.updateOptions();return}}throw new Error("Selected language not available")},disable:function disable(){c.disabled=!0;a(c)},updateOptions:function updateOptions(){var d=j.getSelectedLanguage();a(c);c.selectedIndex=0;var e=h.getSelectedCourse().languages;for(var f in e){var g=e[f];b(g);if(g==d){c.selectedIndex=c.childElementCount-1}}}}}(),k=function(){var q=document.getElementById("id_taskurl"),r=document.getElementById("id_name"),s=document.getElementById("id_mumie_complete_course");function b(){if(!c()){r.value=d(k.getSelectedTask())}}function c(){if(0==r.value.length){return!1}return!g().includes(r.value)}function d(a){if(!a){return null}for(var b in a.headline){var c=a.headline[b];if(c.language==j.getSelectedLanguage()){return c.name}}return null}function e(){var a=[];for(var b in f.getAllServers()){var c=f.getAllServers()[b];for(var d in c.courses){var e=c.courses[d];for(var g in e.tasks){var h=e.tasks[g];a.push(h)}}}return a}function g(){var a=[],b=e();b.push(o(h.getSelectedCourse()));for(var c in b){var d=b[c];for(var f in d.headline){a.push(d.headline[f].name)}}var g=h.getSelectedCourse();for(var i in g.name){var j=g.name[i];a.push(j.value)}return a}function l(a){return a.link+"?lang="+j.getSelectedLanguage()}function m(a){if(null!==d(a)){var b=document.createElement("option");b.setAttribute("value",l(a));b.text=d(a);q.append(b)}}function n(a){var b=o(a),c=document.createElement("option");c.setAttribute("value",l(b));c.text=d(b);q.append(c)}function o(a){var b=[];for(var c in a.name){var d=a.name[c];b.push({name:d.value,language:d.language})}return{link:a.link,headline:b}}function p(){return s.checked}return{init:function init(a){b();q.onchange=function(){b()};s.onchange=function(){k.updateOptions()};k.updateOptions(a?q.options[q.selectedIndex].getAttribute("value"):void 0)},getSelectedTask:function getSelectedTask(){var a=q.options[q.selectedIndex]==void 0?void 0:q.options[q.selectedIndex].getAttribute("value"),b=h.getSelectedCourse(),c=b.tasks.slice();c.push(o(b));for(var d in c){var e=c[d];if(a==l(e)){return e}}return null},disable:function disable(){q.disabled=!0;a(q)},updateOptions:function updateOptions(c){a(q);q.selectedIndex=0;if(p()){n(h.getSelectedCourse())}else{var d=h.getSelectedCourse().tasks;for(var e in d){var f=d[e];m(f);if(c===l(f)){q.selectedIndex=q.childElementCount-1}}}b()},useCompleteCourse:function useCompleteCourse(){return p()}}}();return{init:function init(a){var e=document.getElementById("id_name").getAttribute("value");if(e&&!b()){require(["core/str","core/notification"],function(a,b){a.get_strings([{key:"mumie_form_missing_server",component:"mod_mumie"}]).done(function(a){b.addNotification({message:a[0]+"<b>"+d.getAttribute("value")+"</b>",type:"problem"})}).fail(b.exception)});f.disable();h.disable();j.disable();k.disable();g.disable()}else{f.init(JSON.parse(document.getElementsByName("mumie_server_structure")[0].value));h.init(e);k.init(e);j.init();g.init()}if(c){require(["auth_mumie/mumie_server_config"],function(b){b.init(c,a)})}}};function a(a){while(a.firstChild){a.removeChild(a.firstChild)}}function b(){return""===document.getElementsByName("mumie_missing_config")[0].getAttribute("value")}});
//# sourceMappingURL=mod_form.min.js.map
