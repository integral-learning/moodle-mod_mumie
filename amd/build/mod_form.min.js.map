{"version":3,"sources":["../src/mod_form.js"],"names":["define","addServerButton","document","getElementById","missingConfig","getElementsByName","lmsSelectorUrl","systemLanguage","serverController","serverStructure","serverDropDown","init","structure","onchange","courseController","updateOptions","getSelectedServer","selectedServerName","options","selectedIndex","text","find","server","name","disable","disabled","removeChildElems","getAllServers","problemSelectorController","problemSelectorButton","problemSelectorWindow","mumieOrg","value","sendResponse","response","postMessage","JSON","stringify","sendSuccess","message","success","sendFailure","addMessageListener","window","addEventListener","event","origin","importObj","parse","data","isGraded","langController","setLanguage","language","taskController","setSelection","link","setIsGraded","focus","displayProblemSelectedMessage","error","require","str","notification","get_strings","component","done","s","addNotification","type","fail","exception","gradingType","getGradingType","onclick","open","encodeURIComponent","urlprefix","getSelectedLanguage","location","onclose","courseDropDown","coursefileElem","addOptionForCourse","course","optionCourse","createElement","selectedLanguage","languages","includes","n","setAttribute","append","updateCoursefilePath","getSelectedCourse","coursefile","isEdit","selectedCourseName","courses","some","selectedCourseFile","forEach","childElementCount","languageElem","languageExists","lang","Error","taskSelectionInput","nameElem","taskDisplayElement","isGradedElem","updateName","newHeadline","getHeadline","getSelectedTask","isCustomName","length","getAllHeadlines","task","headlineWrapper","headline","localHeadline","getAllTasks","flatMap","tasks","map","concat","getLocalizedLinkFromTask","getLocalizedLink","updateGradeEditability","getPseudoTaskFromCourse","i","push","selectedLink","slice","newSelection","multiTaskEditController","propertySelectionInputs","selectedTaskProperties","selectedTaskProp","taskSelectionInputs","selectedTasks","selectedTaskIds","sectionInputs","pushIfNotExists","array","element","setTaskSelectionListeners","checkbox","checked","filter","elem","setPropertySelectionListeners","setSectionSelectionListeners","sectionCheckbox","taskCheckbox","getAttribute","disableDropDownMenus","errorKey","contextid","prbSelectorUrl","serverConfigExists","MumieServer","firstChild","removeChild"],"mappings":"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","sourcesContent":["define(['jquery', 'core/templates', 'core/modal_factory', 'auth_mumie/mumie_server_config', 'core/ajax'],\n    function() {\n        const addServerButton = document.getElementById(\"id_add_server_button\");\n        const missingConfig = document.getElementsByName(\"mumie_missing_config\")[0];\n        let lmsSelectorUrl;\n        let systemLanguage;\n        const serverController = (function() {\n            let serverStructure;\n            const serverDropDown = document.getElementById(\"id_server\");\n\n            return {\n                init: function(structure) {\n                    serverStructure = structure;\n                    serverDropDown.onchange = function() {\n                        courseController.updateOptions();\n                    };\n                },\n                getSelectedServer: function() {\n                    const selectedServerName = serverDropDown.options[serverDropDown.selectedIndex].text;\n                    return serverStructure.find(server => server.name === selectedServerName);\n                },\n                disable: function() {\n                    serverDropDown.disabled = true;\n                    removeChildElems(serverDropDown);\n                },\n                getAllServers: function() {\n                    return serverStructure;\n                }\n            };\n        })();\n\n        const problemSelectorController = (function() {\n            const problemSelectorButton = document.getElementById('id_prb_selector_btn');\n            let problemSelectorWindow;\n            const mumieOrg = document.getElementsByName('mumie_org')[0].value;\n\n            /**\n             * Send a message to the problem selector window.\n             *\n             * Don't do anything, if there is no problem selector window.\n             * @param {Object} response\n             */\n            function sendResponse(response) {\n                if (!problemSelectorWindow) {\n                    return;\n                }\n                problemSelectorWindow.postMessage(JSON.stringify(response), lmsSelectorUrl);\n            }\n\n            /**\n             * Send a success message to problem selector window\n             * @param {string} message\n             */\n            function sendSuccess(message = '') {\n                sendResponse({\n                    success: true,\n                    message: message\n                });\n            }\n\n            /**\n             * Send a failure message to problem selector window\n             * @param {string} message\n             */\n            function sendFailure(message = '') {\n                sendResponse({\n                    success: false,\n                    message: message\n                });\n            }\n\n            /**\n             * Add an event listener that accepts messages from LMS-Browser and updates the selected problem.\n             */\n            function addMessageListener() {\n                window.addEventListener('message', (event) => {\n                    if (event.origin !== lmsSelectorUrl) {\n                        return;\n                    }\n                    const importObj = JSON.parse(event.data);\n                    const isGraded = importObj.isGraded !== false;\n                    try {\n                        langController.setLanguage(importObj.language);\n                        taskController.setSelection(importObj.link + '?lang=' + importObj.language);\n                        taskController.setIsGraded(isGraded);\n                        sendSuccess();\n                        window.focus();\n                        displayProblemSelectedMessage();\n                    } catch (error) {\n                        sendFailure(error.message);\n                    }\n                  }, false);\n            }\n\n            /**\n             * Display a success message in Moodle that a problem was successfully selected.\n             */\n            function displayProblemSelectedMessage() {\n                require(['core/str', \"core/notification\"], function(str, notification) {\n                    str.get_strings([{\n                        'key': 'mumie_form_updated_selection',\n                        component: 'mod_mumie'\n                    }]).done(function(s) {\n                        notification.addNotification({\n                            message: s[0],\n                            type: \"info\"\n                        });\n                    }).fail(notification.exception);\n                });\n            }\n\n            return {\n                init: function() {\n                    const gradingType = taskController.getGradingType();\n                    problemSelectorButton.onclick = function() {\n                        problemSelectorWindow = window.open(\n                            lmsSelectorUrl\n                                + '/lms-problem-selector?'\n                                + 'org='\n                                + mumieOrg\n                                + '&serverUrl='\n                                + encodeURIComponent(serverController.getSelectedServer().urlprefix)\n                                + '&problemLang='\n                                + langController.getSelectedLanguage()\n                                + '&origin=' + encodeURIComponent(window.location.origin)\n                                + '&uiLang=' + systemLanguage\n                                + '&gradingType=' + gradingType\n                            , '_blank'\n                        );\n                    };\n\n                    window.onclose = function() {\n                        sendSuccess();\n                    };\n\n                    window.addEventListener(\"beforeunload\", function() {\n                        sendSuccess();\n                     }, false);\n\n                    addMessageListener();\n                },\n                disable: function() {\n                    problemSelectorButton.disabled = true;\n                }\n            };\n        })();\n\n        const courseController = (function() {\n            const courseDropDown = document.getElementById(\"id_mumie_course\");\n            const coursefileElem = document.getElementsByName(\"mumie_coursefile\")[0];\n\n            /**\n             * Add a new option the the 'MUMIE Course' drop down menu\n             * @param {Object} course\n             */\n            function addOptionForCourse(course) {\n                const optionCourse = document.createElement(\"option\");\n                const selectedLanguage = langController.getSelectedLanguage();\n                let name;\n                // If the currently selected language is not available on the server, we need to select another one.\n                if (!course.languages.includes(selectedLanguage)) {\n                    name = course.name[0];\n                } else {\n                    name = course.name.find(n => n.language === selectedLanguage);\n                }\n                optionCourse.setAttribute(\"value\", name.value);\n                optionCourse.text = name.value;\n                courseDropDown.append(optionCourse);\n            }\n\n            /**\n             * Update the hidden input field with the selected course's course file path\n             */\n            function updateCoursefilePath() {\n                coursefileElem.value = courseController.getSelectedCourse().coursefile;\n            }\n\n            return {\n                init: function(isEdit) {\n                    courseDropDown.onchange = function() {\n                        updateCoursefilePath();\n                    };\n                    courseController.updateOptions(isEdit ? coursefileElem.value : false);\n                },\n                getSelectedCourse: function() {\n                    const selectedCourseName = courseDropDown.options[courseDropDown.selectedIndex].text;\n                    const courses = serverController.getSelectedServer().courses;\n\n                    return courses.find(course => {\n                        return course.name.some(name => name.value === selectedCourseName);\n                    });\n                },\n                disable: function() {\n                    courseDropDown.disabled = true;\n                    removeChildElems(courseDropDown);\n                },\n                updateOptions: function() {\n                    const selectedCourseFile = coursefileElem.value;\n                    removeChildElems(courseDropDown);\n                    courseDropDown.selectedIndex = 0;\n                    serverController.getSelectedServer().courses\n                        .forEach(course => {\n                            addOptionForCourse(course);\n                            if (course.coursefile === selectedCourseFile) {\n                                courseDropDown.selectedIndex = courseDropDown.childElementCount - 1;\n                            }\n                        });\n                    updateCoursefilePath();\n                }\n            };\n        })();\n\n        const langController = (function() {\n            const languageElem = document.getElementById(\"id_language\");\n\n            /**\n             * Check if the given language exists in the currently selected course.\n             * @param {string} lang\n             * @returns {boolean} Whether the language exists\n             */\n            function languageExists(lang) {\n                return courseController.getSelectedCourse().languages.includes(lang);\n            }\n            return {\n                getSelectedLanguage: function() {\n                    return languageElem.value;\n                },\n                setLanguage: function(lang) {\n                    if (!languageExists(lang)) {\n                        throw new Error(\"Selected language not available\");\n                    }\n                    languageElem.value = lang;\n                }\n            };\n        })();\n\n        const taskController = (function() {\n            const taskSelectionInput = document.getElementsByName(\"taskurl\")[0];\n            const nameElem = document.getElementById(\"id_name\");\n            const taskDisplayElement = document.getElementById(\"id_task_display_element\");\n            const isGradedElem = document.getElementById('id_mumie_isgraded');\n\n\n            /**\n             * Update the activity's name in the input field\n             */\n            function updateName() {\n                const newHeadline = getHeadline(taskController.getSelectedTask());\n                if (!isCustomName()) {\n                    nameElem.value = newHeadline;\n                }\n                taskDisplayElement.value = newHeadline;\n            }\n\n            /**\n             * Check whether the activity has a custom name\n             *\n             * @return {boolean} True, if there is no headline with that name in all tasks\n             */\n            function isCustomName() {\n                if (nameElem.value.length === 0) {\n                    return false;\n                }\n                return !getAllHeadlines().includes(nameElem.value);\n            }\n\n            /**\n             * Get the task's headline for the currently selected language\n             * @param {Object} task\n             * @returns  {string|null} the headline\n             */\n            function getHeadline(task) {\n                if (!task) {\n                    return null;\n                }\n                const selectedLanguage = langController.getSelectedLanguage();\n                const headlineWrapper = task.headline.find(localHeadline => localHeadline.language === selectedLanguage);\n                return headlineWrapper ? headlineWrapper.name : null;\n            }\n\n            /**\n             * Get all tasks that are available on all servers\n             *\n             * @return {Object} Array containing all available tasks\n             */\n            function getAllTasks() {\n                return serverController.getAllServers()\n                    .flatMap(server => server.courses)\n                    .flatMap(course => course.tasks);\n            }\n\n            /**\n             * Get all possible headlines in all languages\n             * @returns {Object} Array containing all headlines\n             */\n            function getAllHeadlines() {\n                return getAllTasks().flatMap(task => task.headline)\n                    .map(headline => headline.name)\n                    .concat(courseController.getSelectedCourse().name.map(n => n.value));\n            }\n\n            /**\n             * Add language parameter to the task's link to display content in the selected language\n             * @param {Object} task\n             * @returns {string}\n             */\n            function getLocalizedLinkFromTask(task) {\n                return getLocalizedLink(task.link);\n            }\n\n            /**\n             * Add language parameter to link\n             * @param {string} link\n             * @returns {string}\n             */\n            function getLocalizedLink(link) {\n                return link + \"?lang=\" + langController.getSelectedLanguage();\n            }\n\n            /**\n             * Form inputs related to grades should be disabled, if the MUMIE Task is not graded.\n             */\n            function updateGradeEditability() {\n                const disabled = isGradedElem.value === '0';\n                document.getElementById('id_points').disabled = disabled;\n                document.getElementById('id_gradepass').disabled = disabled;\n                document.getElementById('id_duedate_enabled').disabled = disabled;\n                document.getElementById('id_gradecat').disabled = disabled;\n            }\n\n            /**\n             * Get a task that links to a course's overview page\n             * @param {Object} course\n             * @returns {Object} task\n             */\n            function getPseudoTaskFromCourse(course) {\n                var headline = [];\n                for (var i in course.name) {\n                    var name = course.name[i];\n                    headline.push({\n                        \"name\": name.value,\n                        \"language\": name.language\n                    });\n                }\n                return {\n                    \"link\": course.link,\n                    \"headline\": headline\n                };\n            }\n\n            return {\n                init: function() {\n                    updateName();\n                },\n                getSelectedTask: function() {\n                    const selectedLink = taskSelectionInput.value;\n                    const tasks = courseController.getSelectedCourse()\n                        .tasks\n                        .slice();\n                    tasks.push(getPseudoTaskFromCourse(courseController.getSelectedCourse()));\n                    return tasks\n                        .find(task => getLocalizedLinkFromTask(task) === selectedLink);\n                },\n                setSelection: function(newSelection) {\n                    taskSelectionInput.value = newSelection;\n                    updateName();\n                },\n                setIsGraded: function(isGraded) {\n                    if (isGraded === null) {\n                        isGradedElem.value = null;\n                    }\n                    isGradedElem.value = isGraded ? '1' : '0';\n                    updateGradeEditability();\n                },\n                getGradingType: function() {\n                    const isGraded = isGradedElem.value;\n                    if (isGraded === '1') {\n                        return 'graded';\n                    } else if (isGraded === '0') {\n                        return 'ungraded';\n                    }\n                    return 'all';\n                }\n            };\n        })();\n\n\n        const multiTaskEditController = (function() {\n            const propertySelectionInputs = document.getElementsByName(\"mumie_multi_edit_property\");\n            const selectedTaskProperties = document.getElementsByName(\"mumie_selected_task_properties\")[0];\n            let selectedTaskProp = [];\n            const taskSelectionInputs = document.getElementsByName(\"mumie_multi_edit_task\");\n            const selectedTasks = document.getElementsByName(\"mumie_selected_tasks\")[0];\n            let selectedTaskIds = [];\n            const sectionInputs = document.getElementsByName(\"mumie_multi_edit_section\");\n\n            /**\n             * Push an element to an array, if it's not already included.\n             *\n             * @param {string[]} array\n             * @param {string} element\n             */\n            function pushIfNotExists(array, element) {\n                if (!array.includes(element)) {\n                    array.push(element);\n                }\n            }\n\n            /**\n             * Set selection listeners for other MUMIE Tasks in the course.\n             */\n            function setTaskSelectionListeners() {\n                taskSelectionInputs.forEach(function(checkbox) {\n                    checkbox.onchange = function() {\n                        if (!checkbox.checked) {\n                            selectedTaskIds = selectedTaskIds.filter(elem => elem !== checkbox.value);\n                        } else {\n                            selectedTaskIds.push(checkbox.value);\n                        }\n                        selectedTasks.value = JSON.stringify(selectedTaskIds);\n                    };\n                });\n            }\n\n            /**\n             * Set selection listeners for properties to apply to MUMIE Tasks in the course.\n             */\n            function setPropertySelectionListeners() {\n                propertySelectionInputs.forEach(function(checkbox) {\n                    checkbox.onchange = function() {\n                        if (!checkbox.checked) {\n                            selectedTaskProp = selectedTaskProp.filter(elem => elem !== checkbox.value);\n                        } else {\n                            selectedTaskProp.push(checkbox.value);\n                        }\n                        selectedTaskProperties.value = JSON.stringify(selectedTaskProp);\n                    };\n                });\n            }\n\n            /**\n             * Set selection listeners for entire section of MUMIE Tasks in the course\n             */\n            function setSectionSelectionListeners() {\n                sectionInputs.forEach(function(sectionCheckbox) {\n                    sectionCheckbox.onchange = function() {\n                        if (!sectionCheckbox.checked) {\n                            taskSelectionInputs.forEach(function(taskCheckbox) {\n                                if (taskCheckbox.getAttribute('section') === sectionCheckbox.value) {\n                                    taskCheckbox.checked = false;\n                                    selectedTaskIds = selectedTaskIds.filter(elem => taskCheckbox.value !== elem);\n                                }\n                            });\n                        } else {\n                            taskSelectionInputs.forEach(function(taskCheckbox) {\n                                if (taskCheckbox.getAttribute('section') === sectionCheckbox.value) {\n                                    taskCheckbox.checked = true;\n                                    pushIfNotExists(selectedTaskIds, taskCheckbox.value);\n                                }\n                            });\n                        }\n                        selectedTasks.value = JSON.stringify(selectedTaskIds);\n                    };\n                });\n            }\n\n            return {\n                init: function() {\n                    setTaskSelectionListeners();\n                    setPropertySelectionListeners();\n                    setSectionSelectionListeners();\n                },\n            };\n        })();\n\n        /**\n         *  Disable all dropdown menus and show notification\n         * @param {string} errorKey\n         */\n        function disableDropDownMenus(errorKey) {\n            require(['core/str', \"core/notification\"], function(str, notification) {\n                str.get_strings([{\n                    'key':  errorKey,\n                    component: 'mod_mumie'\n                }]).done(function(s) {\n                    notification.addNotification({\n                        message: s[0] + \"<b>\" + missingConfig.getAttribute(\"value\") + \"</b>\",\n                        type: \"problem\"\n                    });\n                }).fail(notification.exception);\n            });\n            serverController.disable();\n            courseController.disable();\n            problemSelectorController.disable();\n        }\n\n        return {\n            init: function(contextid, prbSelectorUrl, lang) {\n                lmsSelectorUrl = prbSelectorUrl;\n                systemLanguage = lang;\n                const isEdit = document.getElementById(\"id_name\").getAttribute('value');\n                const serverStructure = JSON.parse(document.getElementsByName('mumie_server_structure')[0].value);\n                if (isEdit && !serverConfigExists()) {\n                    disableDropDownMenus('mumie_form_missing_server');\n                } else if (!serverStructure.length) {\n                    disableDropDownMenus('mumie_form_no_server_conf');\n                } else {\n                    serverController.init(serverStructure);\n                    courseController.init(isEdit);\n                    taskController.init(isEdit);\n                    multiTaskEditController.init();\n                    problemSelectorController.init();\n                }\n                multiTaskEditController.init();\n                if (addServerButton) {\n                    require(['auth_mumie/mumie_server_config'], function(MumieServer) {\n                        MumieServer.init(addServerButton, contextid);\n                    });\n                }\n            }\n        };\n\n        /**\n         * Remove all child elements of a given html element\n         * @param {Object} elem\n         */\n        function removeChildElems(elem) {\n            while (elem.firstChild) {\n                elem.removeChild(elem.firstChild);\n            }\n        }\n\n        /**\n         * Check, if the flag for an existing config is set\n         * @returns {boolean}\n         */\n        function serverConfigExists() {\n            return document.getElementsByName(\"mumie_missing_config\")[0].getAttribute(\"value\") === \"\";\n        }\n    });\n"],"file":"mod_form.min.js"}